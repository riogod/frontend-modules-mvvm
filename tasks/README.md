# MFE Architecture Tasks

Этот документ содержит структурированный план реализации MFE (Micro-Frontends) архитектуры для проекта.

## 📋 Обзор задач

| #   | Задача                                                           | Статус       | Время | Зависимости   |
| --- | ---------------------------------------------------------------- | ------------ | ----- | ------------- |
| 001 | [Реструктуризация проекта](./001-project-restructure.md)         | 🟢 Завершена | 4-6ч  | -             |
| 002 | [Vite конфигурация для MFE модулей](./002-vite-module-config.md) | 🟢 Завершена | 6-8ч  | 001           |
| 003 | [Базовая структура CLI Runner](./003-cli-launcher-base.md)       | 🟢 Завершена | 4-6ч  | 001           |
| 004 | [Менеджер конфигураций CLI](./004-cli-config-manager.md)         | 🟢 Завершена | 6-8ч  | 003           |
| 005 | [Генератор MFE модулей](./005-cli-module-generator.md)           | 🟢 Завершена | 6-8ч  | 002, 003      |
| 006 | [Vite плагины для Host](./006-host-vite-plugins.md)              | ⚪ Не начата | 4-6ч  | 001, 004      |
| 007 | [ModulesDiscoveryHandler](./007-modules-discovery-handler.md)    | ⚪ Не начата | 6-8ч  | 001, 006      |
| 008 | [RemoteModuleLoader](./008-remote-module-loader.md)              | ⚪ Не начата | 6-8ч  | 007           |
| 009 | [Production Build & CI/CD](./009-federation-production-build.md) | ⚪ Не начата | 8-12ч | 002, 006, 008 |
| 010 | [CSS изоляция](./010-css-isolation.md)                           | ⚪ Не начата | 4-6ч  | 001, 002      |

**Общее время**: ~56-76 часов (2-3 недели работы)

## 🔗 Граф зависимостей

```
                    ┌─────────────────┐
                    │ 001: Restructure │
                    └────────┬────────┘
                             │
           ┌─────────────────┼─────────────────┐
           │                 │                 │
           ▼                 ▼                 ▼
    ┌────────────┐    ┌────────────┐    ┌────────────┐
    │ 002: Vite  │    │ 003: CLI   │    │ 010: CSS   │
    │ Module Cfg │    │ Base       │    │ Isolation  │
    └─────┬──────┘    └─────┬──────┘    └────────────┘
          │                 │
          │           ┌─────┴─────┐
          │           │           │
          ▼           ▼           ▼
    ┌────────────┐  ┌────────────┐
    │ 005: Module│  │ 004: Config│
    │ Generator  │  │ Manager    │
    └────────────┘  └─────┬──────┘
                          │
                          ▼
                   ┌────────────┐
                   │ 006: Vite  │
                   │ Plugins    │
                   └─────┬──────┘
                         │
                         ▼
                   ┌────────────┐
                   │ 007: Module│
                   │ Discovery  │
                   └─────┬──────┘
                         │
                         ▼
                   ┌────────────┐
                   │ 008: Remote│
                   │ Loader     │
                   └─────┬──────┘
                         │
           ┌─────────────┘
           │
           ▼
    ┌────────────┐
    │ 009: Prod  │
    │ Build      │
    └────────────┘
```

## 🚀 Рекомендуемый порядок выполнения

### Фаза 1: Подготовка инфраструктуры (Неделя 1) ✅

1. **Задача 001** - Реструктуризация проекта ✅
   - ✅ Создание `packages/`
   - ✅ Перенос модулей `todo`, `api_example`
   - ✅ Обновление workspaces и tsconfig

2. **Задача 002** - Vite конфигурация ✅
   - ✅ `createModuleConfig()` в `@platform/vite-config`
   - ✅ `vite.config.mts` для модулей
   - ✅ Настройка Federation

3. **Задача 003** - CLI Runner Base ✅
   - ✅ Структура `scripts/launcher/`
   - ✅ Module Discovery
   - ✅ Базовое меню

### Фаза 2: CLI и Integration (Неделя 2) 🟡

4. **Задача 004** - Config Manager ✅
   - ✅ CRUD для конфигураций
   - ✅ Remote Server URL
   - ✅ Запуск с конфигурацией
   - ✅ Интерактивное создание конфигураций:
     - ✅ Список модулей с текущими настройками
     - ✅ Интерактивный цикл редактирования (выбор → редактирование → возврат)
     - ✅ Autocomplete для быстрого поиска модулей
     - ✅ Три опции: LOCAL / REMOTE / Пропустить
     - ✅ По умолчанию все модули пропускаются
     - ✅ Умная обработка Remote URL (недоступно если не настроен)

5. **Задача 005** - Module Generator ✅
   - ✅ Шаблоны модулей
   - ✅ Интерактивное создание
   - ✅ MVVM структура
   - ✅ Интеграция в CLI Runner

6. **Задача 006** - Vite Plugins
   - `moduleAliases` плагин
   - `manifestMiddleware` плагин
   - Интеграция с Host

### Фаза 3: Bootstrap Integration (Неделя 2-3)

7. **Задача 007** - ModulesDiscoveryHandler
   - Загрузка манифеста
   - LOCAL/REMOTE определение
   - Интеграция с Bootstrap

8. **Задача 008** - RemoteModuleLoader
   - Federation runtime
   - Retry логика
   - Кеширование

### Фаза 4: Production & Polish (Неделя 3)

9. **Задача 009** - Production Build
   - Build скрипты
   - CI/CD pipeline
   - Версионирование

10. **Задача 010** - CSS Isolation (можно параллельно)
    - CSS Modules
    - ESLint правила
    - Документация

## ⚡ Quick Start (минимальная реализация)

Если нужен быстрый прототип за неделю:

```
День 1-2: Задача 001 (Restructure)
День 3-4: Задачи 003-004 (CLI Runner базовый)
День 5-6: Задача 006-007 (Vite плагины + Discovery)
День 7: Тестирование и фиксы
```

После этого будет работать:

- Выбор LOCAL модулей в CLI
- Запуск приложения с модулями из `packages/`
- HMR для локальной разработки

Затем итеративно добавить:

- REMOTE модули (Federation)
- Production сборку
- Генератор модулей

## 📊 Статусы задач

- ⚪ **Не начата** - Задача ждет выполнения
- 🔵 **В работе** - Задача в процессе выполнения
- 🟡 **На ревью** - Задача выполнена, ждет проверки
- 🟢 **Завершена** - Задача полностью выполнена
- 🔴 **Заблокирована** - Задача заблокирована из-за зависимостей

## 🏗️ Архитектурные принципы

### Централизация в @platform/vite-config

Вся инфраструктура MFE централизована в пакете `@platform/vite-config`:

| Компонент          | Путь               | Описание                                                    |
| ------------------ | ------------------ | ----------------------------------------------------------- |
| **Типы манифеста** | `plugins/types.ts` | 🔑 Единый источник `AppManifest`, `ModuleManifestEntry`     |
| **Vite плагины**   | `plugins/`         | `moduleAliases`, `manifestMiddleware`, `loadManifest`       |
| **Build утилиты**  | `build/`           | `generateManifest`, `getModuleVersion`, `discoverModules`   |
| **Конфигурации**   | `*.config.ts`      | `createHostConfig`, `createModuleConfig`, `createLibConfig` |

### Граф зависимостей типов

```
@platform/vite-config/plugins/types.ts   ← 🔑 ЕДИНЫЙ ИСТОЧНИК
       │
       ├── plugins/*.ts (Vite плагины)
       ├── build/*.ts (Build утилиты)
       └── host/src/bootstrap/ (реэкспорт)
              │
              └── ModulesDiscoveryHandler.ts
```

**Важно**: Типы манифеста НЕ дублируются, а импортируются из единого источника.

## 📝 Формат задачи

Каждая задача содержит:

1. **Статус** - текущее состояние задачи
2. **Описание** - что делает задача
3. **Зависимости** - какие задачи должны быть выполнены до
4. **Подзадачи** - детальный чек-лист действий
5. **Definition of Done** - критерии завершения
6. **Риски** - потенциальные проблемы и их решения
7. **Время** - ожидаемое время выполнения

## 🔄 Обновление статусов

При работе над задачей:

1. Измените статус на 🔵 **В работе**
2. Отмечайте выполненные подзадачи `[x]`
3. После завершения измените статус на 🟢 **Завершена**

## 📚 Связанные документы

- [mfe-task.md](../mfe-task.md) - Полный план MFE архитектуры
- [README.md](../README.md) - Документация проекта
